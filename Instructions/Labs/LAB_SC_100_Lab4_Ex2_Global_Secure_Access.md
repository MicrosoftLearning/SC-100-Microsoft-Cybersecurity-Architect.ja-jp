# ラボ 4 - 演習 2 - グローバル セキュア アクセス

監視サーバーを設定したら、グローバル セキュア アクセス (GSA) を使用してファイル サーバーへの安全なネットワークを確立する必要があります。 特に Tailwind Traders が会社の IT インフラストラクチャにローカル サーバーを導入する場合は、これらのファイル サーバーをセキュリティで保護されたクラウド ストレージに移行できるようになるまで、これらのマシンへのアクセスをセキュリティで保護する必要があります。 あなたは、従業員がサーバーにアクセスできるように Tailwind Traders の VPN インフラストラクチャを作り直すことにしました。 

セキュアなネットワークを確立するには、まず、コネクタを作成する前に、Azure アプリ プロキシを作成し、クライアントを Entra ID に登録します。 その後、アクセス ポリシーを構成し、GSA クライアントをインストールします。 最後に、GSA 接続をテストして、すべてが正常に動作していることを確認します。

## パート 1: ソリューションを設計する (必須)

このタスクでは、オンプレミス環境へのリモート アクセスをセキュリティで保護します。

### 設計アプローチ

最初の手順では、説明されているシナリオに基づいて要件を分析し、目的を理解し、要件を定義します。

提供されているユース ケースに基づいて、次の要件を概説できます。

- オンプレミス サーバーのセキュリティで保護されたリモート アクセスを有効にする
- 既存のインフラストラクチャとの統合
- Tailwind Traders の非推奨のインフラストラクチャを使用しない

Global Secure Access は Contoso Ltd. の既存のクラウド インフラストラクチャと統合され、従業員は Tailwind Traders ローカル インフラストラクチャ内のローカル サーバーに安全にリモート接続できます。 GSA を確認し、サービスへのリモート アクセスに関する他の戦略との違いを考慮します。

### 提案されるソリューション
<!--BITE AUSFÜLLEN-->
|要件|解決策|行動計画|
|----|----|----|
|オンプレミス サーバーのセキュリティで保護されたリモート アクセスを有効にする| EntraID Global Secure Access | グローバル セキュア アクセスを有効にする  |
|既存のインフラストラクチャとの統合 | アプリケーション プロキシ | Contoso のファイルサーバーにアプリケーション プロキシをデプロイする |

## パート 2: ソリューションを実施する (オプション)

## タスク 1: Global Secure Access のアクティブ化

最初の手順は、テナントで Global Secure Access をアクティブ化します。 これにより、Azure アプリ プロキシを使用して、オンプレミスのリソースへの安全なアクセスを提供できます。

1. **Client 1 VM** (LON-CL1) に **lon-cl1\admin** アカウントでログインします。 パスワードは、ラボ ホスティング プロバイダーから支給されます。
2. **Microsoft Edge** を開いて、アドレス バーを選び、**https://entra.microsoft.com** に移動して、Entra ポータルに **MOD 管理者**admin@WWLxZZZZZZ.onmicrosoft.comとしてログインします (ZZZZZZ は、ラボ ホスティング プロバイダーによって提供された固有のテナント ID)。 ユーザーのパスワードは、ラボ ホスティング プロバイダーから支給されます。
3. 多要素認証をセットアップするように求められたら、手順に従います。
4. [サインインの状態を維持しますか?] ダイアログボックスで、[今後このメッセージを表示しない] チェックボックスを選択してから、**[いいえ]** を選択します。
5. [いいえ] を選択して下部で表示されるパスワード保存のダイアログを閉じ、ご利用のブラウザー内で既存のグローバル管理者の認証情報が保存されないようにします。
6. 左側のナビゲーション ウィンドウで **[Global Secure Access]** を展開し、**[Dashboard]** を選択します。
7. **テナント内の [Global Secure Access をアクティブ化する]** で、**[アクティブ化]** を選択します。

Global Secure Access が正常にアクティブ化されました。

## タスク 2: アプリケーション プロキシをデプロイする

グローバル セキュア アクセスは、ローカル リソースの安全なクラウド エンドポイントを作成できるアプリケーション プロキシに基づいています。 この場合、前に設定したテスト サーバーがプロキシ インフラストラクチャ経由で通信することを許可します。

1. **Server 1 VM** (LON-SC2) に **lon-sc1\admin** アカウントでログインします。 パスワードは、ラボ ホスティング プロバイダーから支給されます。
2. **Microsoft Edge** を開いて、アドレス バーを選び、**https://entra.microsoft.com** に移動して、Entra ポータルに **MOD 管理者**admin@WWLxZZZZZZ.onmicrosoft.comとしてログインします (ZZZZZZ は、ラボ ホスティング プロバイダーによって提供された固有のテナント ID)。 ユーザーのパスワードは、ラボ ホスティング プロバイダーから支給されます。
3. 左側のナビゲーション ウィンドウの **[グローバル セキュア アクセス]** で、**[接続]** を展開し、**[コネクタ]** を選択します。
4. **[コネクタ サービスのダウンロード]** を選択します。
5.  **[使用条件に同意してダウンロードする]** を選択します。
6.  **Microsoft Azure Active Directory アプリケーション プロキシ コネクタ**をインストールします。
7.  インストール中に、ラボで指定されたユーザー名とパスワードを使用してサインインする必要があります。
8.  **CMD** を開き、**ipconfig** コマンドを実行して、IP アドレスをメモします。
9.  Entra ポータルに戻り、[コネクタ] ページを更新します。

オンボードされた VM と関連付けられている IP アドレスが表示されます。 つまり、コネクタが正常に設定されたということです。

## タスク 3: ファイル サーバーに共有を作成する

このタスクでは、GSA を介してアクセスされる SMB 共有をオンプレミス ファイル サーバーに作成します。

1. 引き続き LON-SC2 にログインしている必要があります。
2. **エクスプローラー**を開き、C: ドライブに移動して、**Share** という名前のフォルダーを作成します。
3. Share フォルダーを選択し、**[プロパティ]** を開きます。
4. **[共有]** を選択します。
5. **[共有...]** を選択します。
6. ドロップダウンから **[すべてのユーザー]** を選択し、**[追加]** を選択します。
7. **[共有]** を選択します。
8. **[いいえ、接続しているネットワークをプライベート ネットワークにします]** を選択します。

## タスク 4: クイック アクセスのセットアップとユーザーの割り当て

ユーザーが GSA クライアントを介してファイル サーバーにアクセスするには、クイック アクセスを有効にし、それをテスト ユーザーに割り当てる必要があります。 この構成がないと、テスト ユーザーはファイル サーバーに接続できません。

1. 左側のナビゲーション ウィンドウで **[アプリケーション]** を展開し、**[クイック アクセス]** を選択します。 次の情報を入力してください。
    - 名前: **SMB から ContosoFS へ**
    - コネクタ グループ: **既定値**
1. **[クイック アクセス アプリケーション セグメントの追加]** を選択し、次の情報を入力します:
    - 宛先の種類: IP アドレス
    - IP アドレス: **お使いの VM の IP アドレス**
    - ポート: 445
1. **適用**を選択します。
1. **[保存]** を選択し、[クイック アクセス] メニューを再度読み込みます。
1. 左側で **[ユーザーとグループ]** を選択します。
1. **[Add user/group](ユーザーまたはグループの追加)** を選択します。
1. **[何も選択されていません]** を選択します。
1. **[MOD 管理者]** を追加します。
1. **[選択]**、**[割り当て]** の順にクリックします。

テスト ユーザー (この場合は管理者アカウント) のクイック アクセスが正常に有効になりました。

## タスク 5: Entra ID へのデバイスの追加　

グローバル セキュア アクセスを使用するには、クライアント エンドポイントを Entra ID に追加する必要があります。 そうしないと、GSA クライアントは機能しません。

1. LON-SC1 に接続し、スタート メニューを開いて、**[設定]** を選択します。
2. **[アカウント]**、**[職場または学校にアクセスする]** の順に選択します。
3. 職場または学校アカウントを追加するには、**[接続]** を選択します。
4. **[デバイスを Entra ID に参加させる]** をクリックします。
5. ラボ プロバイダーによって提供される **MOD 管理者**の管理資格情報を使用してサインインします。

エンドポイントが Entra ID に参加すると、GSA クライアントを使用して、グローバル セキュア アクセスで保護している任意のリソースに接続できるようになります。

## タスク 6: プロファイルをアクティブ化し接続を検証する

グローバル セキュア アクセスは、2 つの部分に分かれています。 今作業している部分はプライベート アクセスと呼ばれ、ファイル サーバーやオンプレミス アプリケーションなどのローカル リソースやプライベート リソースを保護します。 ファイル サーバーへのアクセスを有効にするには、プライベート アクセス プロファイルを有効にする必要があります。このプロファイルにより、ユーザーは割り当てられているリソースにクイック アクセスを介してアクセスできます。

1. Microsoft Entra 管理センターの左側のナビゲーション ウィンドウにある [グローバル セキュア アクセス] メニューから、**[接続]** を展開して **[トラフィック転送]** を選択します。
2. **[プライベート アクセス プロファイル]** をオンにします。
3. **[OK]** を選択します。
4. 左側のナビゲーション ウィンドウの **[接続]** で **[クライアント ダウンロード]** を選択します。
5. Windows 10/11 で、**[クライアントのダウンロード]** を選択します。
6. **グローバル セキュア アクセス クライアント**をインストールします。
7. インストール中に、MOD 管理者でサインインする必要があります。
8. Windows で**エクスプローラー**を開き、**[PC]** メニュー バーに移動し、省略記号 (...) アイコンを選択して **[ネットワーク ドライブの割り当て]** を選択します。
9. フォルダー: `\\IP-ADDRESS\Share` (前の手順でメモした IP アドレスを使用します)。
10. **[完了]** を選びます。
11. ローカルのユーザー名とパスワードを入力して、ネットワーク ドライブをマップします。


グローバル セキュア アクセスを使用して、ファイル サーバーに正常に接続されました。
