# Entra ID を構成する

あなたは、Contoso Ltd の IT セキュリティ スペシャリストに新しく昇格した Allan Deyoung です。会社が最近 Tailwind Traders を買収したので、Entra ID テナントを確認し、新しいセキュリティ要件を決定しました。 タスクは、買収に伴う要件を満たすためにタスクを管理し、ポリシーを実装することです。

エンタープライズ アプリケーションを確認し、一部のユーザーがメールボックス データにアクセスするためのサード パーティ製アプリケーションのアクセス許可を付与していることを確認しました。 これは、電子メールの通信によるデータ損失の潜在的なリスクです。 そのため、この動作を制限しますが、ユーザーには Microsoft が検証した Web サイトにサインインしてログイン ID を共有できるように許可します。 また、ユーザーが自分の Entra ID ID を使用して新しい SaaS 製品への特定のアクセスを要求できるようにする必要があります。 

パートナー組織が最近 SMS の傍受を使用した攻撃を受けたため、NIST に従って認証保証を適用する必要があります。 これを実現するには、SMS OTP を非アクティブ化し、組織内の AAL1 認証方法の使用を制限する認証強度ポリシーを作成します。 この構成は、Entra ID ポータルで作成します。

## パート 1: ソリューションを設計する (必須)

このタスクでは、Contoso Ltd. が直面しているリスクに対処するための概念を設計します。

### 設計アプローチ

最初の手順では、説明されている問題に基づいて要件を分析し、目的を理解し、要件を定義します。

提供されているユース ケースに基づいて、次の要件を概説できます。

- サード パーティ製アプリケーションからの制御されていないアクセスを制限する
- 検証済みサービスへのログイン ID の共有をユーザーに許可する
- ユーザーが SaaS 製品へのアクセスを要求できるようにする
- 認証強度の向上

2 番目の手順では、Contoso Ltd. の既存の環境を調べます。 Microsoft Entra ID は、Entra ID ポリシーを使用してユーザーとクラウド アプリケーションのアクセスを管理および制限するソリューションを提供します。 どのコントロールが存在し、どのポリシーが既に実施されているかを調査します。 Entra ID ポータルを使用して、現在の構成とポリシーを確認し、調整が必要かどうか、または新しいポリシーを実装する必要があるかどうかを判断します。

3 番目のフェーズでは、ソリューションの概念を作成します。 調査の結果、現在のポリシーのいずれも定義された要件を満たしていないのは明らかです。 そのため、Entra ID 構成の調整が不可欠です。

### 提案されるソリューション

|要件|解決策|行動計画|
|----|----|----|
|サード パーティ製アプリケーションからの制御されていないアクセスをブロックする|Entra ID アプリケーション ポリシー|確認済みの発行元のアプリまたはこの組織に登録されているアプリには、"低影響" と分類されたアクセス許可について、ユーザーの同意を制限します。|
|検証済みサービスへのログイン ID の共有をユーザーに許可する|Entra ID アプリケーション ポリシー|確認済みの発行元のアプリまたはこの組織に登録されているアプリには、"低影響" と分類されたアクセス許可について、ユーザーの同意を制限します。|
|ユーザーが SaaS 製品へのアクセスを要求できるようにする|Entra ID アプリケーション ポリシー|安全に使用できるアプリケーションを承認できるユーザーを定義する|
|安全でない認証方法の使用を制限する|Entra ID 認証方法|SMS と音声の方法を除く認証強度を作成する|

## パート 2: ソリューションを実施する (オプション)

**注:** これらのラボの手順は、M365 ラボ プロファイルで実行する必要があります。

### タスク 1 - サード パーティ製アプリの使用を Microsoft 検証済みサービスに制限する

このタスクでは、ユーザーがアプリケーションに付与できるアクセス レベルを制限します。 また、ユーザーが自分で許可できないアクセス権を要求する機能も追加します。 

1. Client 1 VM (LON-Sc1) に **lon-cl1\admin** アカウントでログインします。 パスワードは、ラボ ホスティング プロバイダーから支給されます。
1. **Microsoft Edge** を開いて、アドレス バーを選び、**`https://entra.microsoft.com`** に移動して、Entra ID ポータルに **MOD 管理者**admin@WWLxZZZZZZ.onmicrosoft.com としてログインします (ZZZZZZ は、ラボ ホスティング プロバイダーによって提供された固有のテナント ID)。 管理者のパスワードは、ラボ ホスティング プロバイダーから提供されます。
1. 多要素認証の設定を求められた場合は、手順に従います。
1. **[サインインの状態を維持しますか?]** ダイアログボックスで、**[今後このメッセージを表示しない]** チェックボックスを選択し、**[いいえ]** を選択します。
1. **[今はしない]** を選択してパスワード保存のダイアログ ボックスを閉じ、ご利用のブラウザー内で既定のグローバル管理者の認証情報が保存されないようにします。
1. 左側のナビゲーション ウィンドウで、**[ID]**、**[アプリケーション]**、**[エンタープライズ アプリケーション]**、**[セキュリティ]**、**[同意とアクセス許可]** の順に移動します。
1. **[アクセス許可の分類]** に移動します。
1. Entra は、**低リスク** アクセス許可に最も使用されるアクセス許可を提案します。
1. これらのすべてのアクセス許可を確認し、**[はい、選択したアクセス許可を追加します]** を選択し、それらを Entra ID テナントで**低リスク**として分類します。
1. **[ユーザーの同意] の設定**に移動します。
1. **[アプリケーションに対するユーザーの同意]** で、推奨オプションの **[確認済みの発行元からのアプリに対して選択されたアクセス許可を与えることへのユーザーの同意を許可する]** を選択します。 これにより、ユーザーは、検証済み発行元のアプリに対して、"影響が低い" (以前に選択した) として分類されたアクセス許可に同意できます。
1. **[保存]** を選択します。
1. **[管理者の同意設定]** に移動し、**[はい]** を選択して管理者の同意要求を有効にして、ユーザーが同意できないアプリに対して管理者の同意を要求できるようにします。
1. **[+ ユーザーの追加]** を選択し、管理者の同意要求を確認できるユーザーとして **`Lidia Holloway`** と **`MOD Administrator`** を追加します。
1. **[管理者の同意設定]** ウィンドウで **[保存]** を選択します。
1. 次のタスクのために、このブラウザー タブを開いたままにします。

これで、すべてのユーザーがアプリケーションに付与できるアクセスを制限する、アプリケーションの同意設定を構成しました。 ユーザーは引き続きアプリケーションにアクセス許可の同意を要求でき、アプリケーション管理者チームは、特定のアプリケーションの必要性とリスクを評価した後で承認できます。

### タスク 2 - 認証強度を作成する

このタスクでは、Entra ID ポータルを使用して独自の認証強度を作成し、組織内での SMS OTP の使用を制限します。 

1. 引き続き Entra ID ポータル **https://entra.microsoft.com** にログインする必要があります。
2. 左側のナビゲーション ウィンドウで、**[保護]**、**[認証方法]**、**[認証強度]** の順に移動します。
3. **[+ 新しい認証強度]** を選択します。
4. 「**強化された MFA**」という名前を入力します。
5. **[フィッシング耐性のある MFA]**、**[パスワードレス MFA]**、および **[多要素認証]** をチェックします。
6. [多要素認証] で、次のチェック ボックスをオフにします。
   - **一時アクセス パス (複数の用途)**
   - **パスワード + SMS**
   - **パスワード + 音声**
   - **フェデレーション単一要素 + SMS**
   - **フェデレーション単一要素 + 音声**
7. [**次へ**] を選択します。
8. 上記のどの要素も認証強度に残されていないことを確認してチェックします。
9.  **［作成］** を選択します

これで、認証要素としての SMS OTP の使用を制限する認証強度が作成されました。
